<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.spring.javaclassS8.dao.admin.AdminDAO">

	<!-- 어드민 이벤트 리스트 조건 검색 -->
<select id="filterEvents" resultType="com.spring.javaclassS8.vo.event.EventVO">
        SELECT * FROM events
        WHERE 1=1
        <if test="eventCategory != null and eventCategory != ''">
            AND eventCategory = #{eventCategory}
        </if>
        <if test="status != null and status != ''">
            AND status = #{status}
        </if>
        <if test="startDate != null and startDate != ''">
            AND startDate >= #{startDate}
        </if>
        <if test="endDate != null and endDate != ''">
            AND endDate &lt;= #{endDate}
        </if>
        <if test="keyword != null and keyword != ''">
            AND (title LIKE CONCAT('%', #{keyword}, '%') 
                 OR content LIKE CONCAT('%', #{keyword}, '%')
                 OR eventCategory LIKE CONCAT('%', #{keyword}, '%')
                 OR status LIKE CONCAT('%', #{keyword}, '%'))
        </if>
        ORDER BY createdAt DESC
    </select>

	<!-- 예매권 발행 -->	
	<insert id="insertAdvanceTicket">
		INSERT INTO advance_tickets (adminId, advanceTicketNumber, used, expiresAt, issuedAt)
		VALUES (#{adminId},	#{advanceTicketNumber}, #{used}, #{expiresAt}, #{issuedAt})
	</insert>
	
	<!-- 이벤트 업로드 -->
	<insert id="insertEvent" parameterType="com.spring.javaclassS8.vo.event.EventVO">
    	INSERT INTO events (adminId, eventCategory, title, content, thumbnail, startDate, endDate, status)
    	VALUES (#{adminId}, #{eventCategory}, #{title}, #{content}, #{thumbnail}, #{startDate}, #{endDate}, #{status})
	</insert>
	
	<update id="updateEvent" parameterType="com.spring.javaclassS8.vo.event.EventVO">
        UPDATE events
        SET title = #{title},
            eventCategory = #{eventCategory},
            content = #{content},
            thumbnail = #{thumbnail},
            startDate = #{startDate},
            endDate = #{endDate},
            status = #{status},
            updatedAt = CURRENT_TIMESTAMP
        WHERE id = #{id}
	</update>
</mapper>